# ğŸ› ï¸ ç¯å¢ƒé…ç½®æŒ‡å—

å®Œæ•´çš„ç”Ÿäº§å°±ç»ª Next.js æ¡†æ¶é…ç½®æŒ‡å—ã€‚

## ğŸ“‹ å‰ç½®è¦æ±‚

- **Node.js** >= 18.0.0
- **npm** >= 9.0.0
- **Supabase è´¦å·**ï¼ˆå…è´¹ï¼‰- [æ³¨å†Œåœ°å€](https://supabase.com)
- **Git**

## ğŸ”§ å®‰è£…æ­¥éª¤

### 1. å®‰è£…é¡¹ç›®ä¾èµ–

```bash
npm install
```

### 2. åˆ›å»º Supabase é¡¹ç›®

#### a. æ³¨å†Œå¹¶åˆ›å»ºé¡¹ç›®

1. è®¿é—® [Supabase](https://supabase.com) å¹¶ç™»å½•
2. ç‚¹å‡» **"New Project"**
3. å¡«å†™é¡¹ç›®ä¿¡æ¯ï¼š
   - **Name**: `prompt-attack`
   - **Database Password**: è®¾ç½®å¼ºå¯†ç ï¼ˆåŠ¡å¿…ä¿å­˜ï¼ï¼‰
   - **Region**: é€‰æ‹© `Northeast Asia (Tokyo)` æˆ–ç¦»ä½ æœ€è¿‘çš„åŒºåŸŸ
   - **Pricing Plan**: `Free`
4. ç‚¹å‡» **"Create new project"**
5. ç­‰å¾…çº¦ 2 åˆ†é’Ÿå®Œæˆåˆå§‹åŒ–

#### b. è·å–æ•°æ®åº“è¿æ¥ä¿¡æ¯

1. è¿›å…¥é¡¹ç›® Dashboard
2. ç‚¹å‡» **Settings** âš™ï¸ â†’ **Database**
3. æ‰¾åˆ° **Connection string** éƒ¨åˆ†
4. å¤åˆ¶ä¸¤ä¸ªè¿æ¥å­—ç¬¦ä¸²ï¼š
   - **Connection Pooling** (ç«¯å£ 6543) - ç”¨äº `DATABASE_URL`
   - **Direct Connection** (ç«¯å£ 5432) - ç”¨äº `DIRECT_URL`

### 3. é…ç½®ç¯å¢ƒå˜é‡

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
# Supabase Database
# ä» Supabase Dashboard -> Settings -> Database å¤åˆ¶
DATABASE_URL="postgres://postgres.[project-ref]:[YOUR-PASSWORD]@aws-0-[region].pooler.supabase.com:6543/postgres?pgbouncer=true&connection_limit=1"
DIRECT_URL="postgres://postgres.[project-ref]:[YOUR-PASSWORD]@aws-0-[region].pooler.supabase.com:5432/postgres"

# NextAuth é…ç½®
NEXTAUTH_URL="http://localhost:3000"
NEXTAUTH_SECRET="generate-a-random-secret-here"

# GitHub OAuthï¼ˆå¯é€‰ï¼‰
GITHUB_ID=""
GITHUB_SECRET=""

# OpenAI API
OPENAI_API_KEY="sk-your-key-here"

# åº”ç”¨é…ç½®
NEXT_PUBLIC_APP_URL="http://localhost:3000"
NODE_ENV="development"
```

**é‡è¦è¯´æ˜**:

- å°† `[YOUR-PASSWORD]` æ›¿æ¢ä¸ºåˆ›å»º Supabase é¡¹ç›®æ—¶è®¾ç½®çš„å¯†ç 
- å°† `[project-ref]` å’Œ `[region]` æ›¿æ¢ä¸ºå®é™…å€¼
- `DATABASE_URL`: ä½¿ç”¨ Connection Poolingï¼ˆ6543 ç«¯å£ï¼‰ï¼Œç”¨äºåº”ç”¨æŸ¥è¯¢
- `DIRECT_URL`: ä½¿ç”¨ Direct Connectionï¼ˆ5432 ç«¯å£ï¼‰ï¼Œç”¨äºæ•°æ®åº“è¿ç§»

**ç”Ÿæˆ NEXTAUTH_SECRET:**

```bash
openssl rand -base64 32
```

> ğŸ“– **è¯¦ç»† Supabase é…ç½®**: æŸ¥çœ‹ [Supabaseé…ç½®æŒ‡å—](../æŠ€æœ¯æ–‡æ¡£/Supabaseé…ç½®æŒ‡å—.md)

### 4. åˆå§‹åŒ–æ•°æ®åº“

é…ç½®å¥½ç¯å¢ƒå˜é‡åï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤åˆå§‹åŒ– Supabase æ•°æ®åº“ï¼š

```bash
# ç”Ÿæˆ Prisma Client
npx prisma generate

# æ¨é€ schema åˆ° Supabase æ•°æ®åº“
npx prisma db push

# ï¼ˆå¯é€‰ï¼‰æ‰“å¼€ Prisma Studio æŸ¥çœ‹æ•°æ®åº“
npx prisma studio
```

**éªŒè¯æ•°æ®åº“è¿æ¥**:

```bash
# æµ‹è¯•è¿æ¥
npx prisma db pull

# å¦‚æœæˆåŠŸï¼Œä¼šæ˜¾ç¤ºæ‰€æœ‰è¡¨ç»“æ„
```

ä½ ä¹Ÿå¯ä»¥åœ¨ Supabase Dashboard ä¸­ï¼š

1. ç‚¹å‡» **Table Editor** æŸ¥çœ‹å·²åˆ›å»ºçš„è¡¨
2. ç‚¹å‡» **SQL Editor** è¿è¡Œ SQL æŸ¥è¯¢

### 5. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

åº”ç”¨å°†åœ¨ `http://localhost:3000` è¿è¡Œ

## âœ… éªŒè¯å®‰è£…

### æ£€æŸ¥å¥åº·ç«¯ç‚¹

```bash
curl http://localhost:3000/api/health
```

é¢„æœŸå“åº”ï¼š

```json
{
  "status": "healthy",
  "version": "1.0.0",
  "services": {
    "database": "up"
  }
}
```

### æµ‹è¯•é¡µé¢

- **é¦–é¡µ**: http://localhost:3000
- **ä»ªè¡¨æ¿**: http://localhost:3000/dashboard
- **ç™»å½•**: http://localhost:3000/login

## ğŸ¯ å¼€å‘å‘½ä»¤

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
npm start

# ä»£ç æ£€æŸ¥
npm run lint

# ä»£ç æ ¼å¼åŒ–
npm run format

# ç±»å‹æ£€æŸ¥
npm run type-check

# æ•°æ®åº“å‘½ä»¤
npm run db:push       # æ¨é€ schema å˜æ›´
npm run db:studio     # æ‰“å¼€ Prisma Studio
npm run db:generate   # ç”Ÿæˆ Prisma Client
npm run db:migrate    # è¿è¡Œè¿ç§»
```

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
prompt-attack/
â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”œâ”€â”€ api/                      # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ auth/[...nextauth]/   # NextAuth
â”‚   â”‚   â”œâ”€â”€ register/             # ç”¨æˆ·æ³¨å†Œ
â”‚   â”‚   â”œâ”€â”€ attack-test/          # æ”»å‡»æµ‹è¯•
â”‚   â”‚   â””â”€â”€ health/               # å¥åº·æ£€æŸ¥
â”‚   â”œâ”€â”€ dashboard/                # ä»ªè¡¨æ¿é¡µé¢
â”‚   â”œâ”€â”€ login/                    # ç™»å½•é¡µé¢
â”‚   â”œâ”€â”€ layout.tsx                # æ ¹å¸ƒå±€
â”‚   â”œâ”€â”€ page.tsx                  # é¦–é¡µ
â”‚   â”œâ”€â”€ providers.tsx             # å®¢æˆ·ç«¯ Provider
â”‚   â””â”€â”€ globals.css               # å…¨å±€æ ·å¼
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/               # React ç»„ä»¶
â”‚   â”‚   â””â”€â”€ ui/                   # shadcn/ui ç»„ä»¶
â”‚   â”œâ”€â”€ features/                 # åŠŸèƒ½æ¨¡å—ï¼ˆå¾…æ‰©å±•ï¼‰
â”‚   â”œâ”€â”€ hooks/                    # è‡ªå®šä¹‰ Hook
â”‚   â”‚   â””â”€â”€ useAttackTest.ts
â”‚   â”œâ”€â”€ lib/                      # æ ¸å¿ƒåº“
â”‚   â”‚   â”œâ”€â”€ db.ts                 # Prisma å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ auth.ts               # NextAuth é…ç½®
â”‚   â”‚   â”œâ”€â”€ auth-helpers.ts       # è®¤è¯å·¥å…·
â”‚   â”‚   â””â”€â”€ store.ts              # Zustand Store
â”‚   â”œâ”€â”€ types/                    # TypeScript ç±»å‹
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ next-auth.d.ts
â”‚   â””â”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ cn.ts                 # ç±»ååˆå¹¶
â”‚       â”œâ”€â”€ errors.ts             # é”™è¯¯å¤„ç†
â”‚       â””â”€â”€ validators.ts         # Zod Schema
â”‚
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma             # æ•°æ®åº“ Schema
â”‚
â”œâ”€â”€ docs/                         # æ–‡æ¡£
â”‚   â”œâ”€â”€ å¼€å‘æŒ‡å—/
â”‚   â”œâ”€â”€ æŠ€æœ¯æ–‡æ¡£/
â”‚   â”œâ”€â”€ ä¸šåŠ¡æ–‡æ¡£/
â”‚   â””â”€â”€ éƒ¨ç½²è¿ç»´/
â”‚
â”œâ”€â”€ .eslintrc.json                # ESLint é…ç½®
â”œâ”€â”€ .prettierrc                   # Prettier é…ç½®
â”œâ”€â”€ next.config.js                # Next.js é…ç½®
â”œâ”€â”€ tailwind.config.ts            # Tailwind é…ç½®
â”œâ”€â”€ tsconfig.json                 # TypeScript é…ç½®
â””â”€â”€ package.json
```

## ğŸ” å®‰å…¨æ³¨æ„äº‹é¡¹

1. **ç»ä¸æäº¤ `.env`** - åŒ…å«æ•æ„Ÿå‡­è¯
2. **ä½¿ç”¨å¼ºå¯†é’¥** - ç”¨ `openssl rand -base64 32` ç”Ÿæˆ
3. **ä¿æŠ¤ API å¯†é’¥** - ä»…å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡ä¸­
4. **å¯ç”¨ HTTPS** - ç”Ÿäº§ç¯å¢ƒå¿…é¡»

## ğŸš¨ å¸¸è§é—®é¢˜

### é—®é¢˜ï¼šPrisma Client é”™è¯¯

```
Error: PrismaClient is unable to be run in the browser
```

**è§£å†³æ–¹æ¡ˆ**: ç¡®ä¿ Prisma ä»…åœ¨æœåŠ¡ç«¯ç»„ä»¶æˆ– API è·¯ç”±ä¸­ä½¿ç”¨ã€‚

### é—®é¢˜ï¼šSupabase æ•°æ®åº“è¿æ¥å¤±è´¥

```
Can't reach database server
```

**è§£å†³æ–¹æ¡ˆ**:

1. æ£€æŸ¥ Supabase é¡¹ç›®æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ï¼ˆFree Plan å¯èƒ½ä¼šæš‚åœï¼‰
2. éªŒè¯ `DATABASE_URL` å’Œ `DIRECT_URL` æ­£ç¡®
3. ç¡®è®¤å¯†ç ä¸­çš„ç‰¹æ®Šå­—ç¬¦å·²æ­£ç¡® URL ç¼–ç 
4. æ£€æŸ¥ç½‘ç»œè¿æ¥

### é—®é¢˜ï¼šè¿æ¥æ± è€—å°½

```
Error: Too many connections
```

**è§£å†³æ–¹æ¡ˆ**:

1. ç¡®ä¿ä½¿ç”¨ `DATABASE_URL`ï¼ˆConnection Poolingï¼‰è€Œé `DIRECT_URL`
2. æ·»åŠ  `connection_limit=1` å‚æ•°åˆ°è¿æ¥å­—ç¬¦ä¸²
3. åœ¨ Supabase Dashboard æ£€æŸ¥è¿æ¥æ•°ä½¿ç”¨æƒ…å†µ

### é—®é¢˜ï¼šNextAuth é”™è¯¯

```
[next-auth][error][SIGNIN_EMAIL_ERROR]
```

**è§£å†³æ–¹æ¡ˆ**: æ£€æŸ¥ `.env` ä¸­æ˜¯å¦è®¾ç½®äº† NEXTAUTH_SECRET

### é—®é¢˜ï¼šTypeScript é”™è¯¯

```
Cannot find module '@/...'
```

**è§£å†³æ–¹æ¡ˆ**: è¿è¡Œ `npm install` å¹¶é‡å¯ TypeScript æœåŠ¡å™¨

## ğŸ“š ä¸‹ä¸€æ­¥

é…ç½®å®Œæˆåï¼Œä½ å¯ä»¥ï¼š

1. **æ·»åŠ é˜²å¾¡é€»è¾‘**: åœ¨ `app/api/attack-test/route.ts` å®ç°å®é™…çš„æ”»å‡»æ£€æµ‹
2. **åˆ›å»ºåŠŸèƒ½æ¨¡å—**: åœ¨ `src/features/` æ·»åŠ æ¨¡å—
3. **å¢åŠ  UI ç»„ä»¶**: åœ¨ `src/components/` æ„å»ºç»„ä»¶
4. **è‡ªå®šä¹‰ä¸»é¢˜**: ç¼–è¾‘ `tailwind.config.ts` ä¸­çš„é¢œè‰²
5. **éƒ¨ç½²**: æŒ‰ç…§éƒ¨ç½²æŒ‡å—è¿›è¡Œ

## ğŸ¤ éœ€è¦å¸®åŠ©ï¼Ÿ

- æŸ¥çœ‹ [å¿«é€Ÿå¼€å§‹.md](./å¿«é€Ÿå¼€å§‹.md) äº†è§£é¡¹ç›®æ¦‚è§ˆ
- æŸ¥çœ‹ [é¡¹ç›®ç»“æ„.md](./é¡¹ç›®ç»“æ„.md) äº†è§£ä»£ç ç»„ç»‡
- é˜…è¯» [ä¸šåŠ¡æ–‡æ¡£](../ä¸šåŠ¡æ–‡æ¡£/) äº†è§£åŠŸèƒ½è¯¦æƒ…
- æäº¤ Issue åˆ° GitHub

---

âœ… é…ç½®å®Œæˆï¼å¼€å§‹æ„å»ºä½ çš„ Prompt Attack é˜²å¾¡ç³»ç»Ÿã€‚
